import{_ as s,c as a,o as t,ag as i}from"./chunks/framework.DvWQHGvG.js";const k=JSON.parse('{"title":"Events (API)","description":"","frontmatter":{},"headers":[],"relativePath":"events/templates-events.md","filePath":"events/templates-events.md"}'),n={name:"events/templates-events.md"};function l(o,e,h,r,p,d){return t(),a("div",null,[...e[0]||(e[0]=[i(`<h1 id="events-api" tabindex="-1">Events (API) <a class="header-anchor" href="#events-api" aria-label="Permalink to &quot;Events (API)&quot;">​</a></h1><p>This page documents the <strong>low‑level API</strong> for DH‑UI’s internal events and its template engine.</p><p>Most users will only need the higher‑level explanations on:</p><ul><li><a href="/Daggerheart-UI/concepts/dynamic-content.html">Dynamic Content</a> – how templates work in block YAML.</li><li><a href="/Daggerheart-UI/concepts/events.html">Events</a> – how rest, damage, and trackers are wired together conceptually.</li></ul><p>If you’re building custom integrations or JS snippets, this page shows how to hook into the same mechanisms DH‑UI uses internally.</p><hr><h2 id="template-engine-overview" tabindex="-1">Template engine overview <a class="header-anchor" href="#template-engine-overview" aria-label="Permalink to &quot;Template engine overview&quot;">​</a></h2><p>Anywhere a block accepts a <strong>string</strong> in YAML (for example in <code>vitals</code>, <code>badges</code>, <code>damage</code>, <code>features</code>, <code>consumables</code>, etc.), you can use templates of the form:</p><div class="language-text vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">text</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>{{ path.to.value }}</span></span>
<span class="line"><span>{{ helper 2 frontmatter.level }}</span></span></code></pre></div><h3 id="common-value-paths" tabindex="-1">Common value paths <a class="header-anchor" href="#common-value-paths" aria-label="Permalink to &quot;Common value paths&quot;">​</a></h3><p>These are the main value sources the template engine exposes:</p><ul><li><code>frontmatter.*</code> – fields from the note’s frontmatter (<code>frontmatter.level</code>, <code>frontmatter.ancestry</code>, etc.).</li><li><code>traits.*</code> – ability scores and bonuses defined in the <code>traits</code> block (<code>traits.Ability.Agility</code>, etc.).</li><li><code>skills.*</code> – any skill data your setup exposes.</li><li><code>character.*</code> – reserved for higher‑level character data; typically derived from frontmatter or traits.</li></ul><h3 id="helper-functions" tabindex="-1">Helper functions <a class="header-anchor" href="#helper-functions" aria-label="Permalink to &quot;Helper functions&quot;">​</a></h3><p>You can perform simple math and derived calculations directly in templates using helpers:</p><ul><li><span><code>{{ add A B }}</code></span> – <code>A + B</code>.</li><li><span><code>{{ subtract A B }}</code></span> – <code>A - B</code>.</li><li><span><code>{{ multiply A B }}</code></span> – <code>A * B</code>.</li><li><span><code>{{ divide A B }}</code></span> – integer division.</li><li><span><code>{{ floor value }}</code></span>, <span><code>{{ ceil value }}</code></span>, <span><code>{{ round value }}</code></span> – rounding helpers.</li><li><span><code>{{ modifier value }}</code></span> – converts a score into a Daggerheart‑style modifier.</li></ul><p>All helpers ultimately resolve to numbers or strings that can be rendered in your block.</p><p>For a full reference, examples, and edge‑case behavior, see <a href="/Daggerheart-UI/concepts/dynamic-content.html">Dynamic Content</a>.</p><hr><h2 id="dom-events" tabindex="-1">DOM events <a class="header-anchor" href="#dom-events" aria-label="Permalink to &quot;DOM events&quot;">​</a></h2><p>DH‑UI emits DOM events so multiple blocks within the <strong>same note preview</strong> can stay in sync. You can listen for these events to react to changes or trigger additional logic.</p><h3 id="tracker-and-key‐value-events" tabindex="-1">Tracker and key‑value events <a class="header-anchor" href="#tracker-and-key‐value-events" aria-label="Permalink to &quot;Tracker and key‑value events&quot;">​</a></h3><p>When a tracked resource changes (HP, Stress, Armor, Hope, or any other key), DH‑UI fires:</p><ul><li><code>dh:tracker:changed</code> – a tracker row changed (for example, a vitals pip was clicked).</li><li><code>dh:kv:changed</code> – a key in the internal key‑value store changed.</li></ul><p>Handlers receive a <code>CustomEvent</code> whose <code>detail</code> typically includes:</p><ul><li><code>key</code> – the storage key (for example <code>tracker:din_health::Character/Marlowe</code>).</li><li>For <code>dh:tracker:changed</code>: <code>filled</code> – the new filled count for that tracker.</li><li>For <code>dh:kv:changed</code>: <code>val</code> – the new value stored for that key.</li></ul><h4 id="example-–-listen-for-tracker-changes" tabindex="-1">Example – listen for tracker changes <a class="header-anchor" href="#example-–-listen-for-tracker-changes" aria-label="Permalink to &quot;Example – listen for tracker changes&quot;">​</a></h4><div class="language-js vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">window.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">addEventListener</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;dh:tracker:changed&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, (</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">event</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  const</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> { </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">key</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">filled</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> } </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (event </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">as</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> CustomEvent</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">).detail </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">??</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {};</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  console.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;Tracker updated&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, key, filled);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">});</span></span></code></pre></div><blockquote><p>Note: In Obsidian, run this from a JS snippet, a developer console, or a custom plugin that loads alongside DH‑UI.</p></blockquote><h3 id="rest-events" tabindex="-1">Rest events <a class="header-anchor" href="#rest-events" aria-label="Permalink to &quot;Rest events&quot;">​</a></h3><p>When you use the <code>rest</code> block, DH‑UI fires events so other components know which kind of rest occurred:</p><ul><li><code>dh:rest:short</code></li><li><code>dh:rest:long</code></li></ul><p>Each event’s <code>detail</code> includes the file path and the HP / Stress / Armor / Hope keys that were updated.</p><h4 id="example-–-react-to-a-long-rest" tabindex="-1">Example – react to a Long Rest <a class="header-anchor" href="#example-–-react-to-a-long-rest" aria-label="Permalink to &quot;Example – react to a Long Rest&quot;">​</a></h4><div class="language-js vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">window.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">addEventListener</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;dh:rest:long&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, (</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">event</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  console.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;Long Rest applied&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, (event </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">as</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> CustomEvent</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">).detail);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">});</span></span></code></pre></div><h3 id="emitting-your-own-events" tabindex="-1">Emitting your own events <a class="header-anchor" href="#emitting-your-own-events" aria-label="Permalink to &quot;Emitting your own events&quot;">​</a></h3><p>You normally <strong>do not need</strong> to emit these events yourself; the built‑in blocks handle it.</p><p>If you are extending DH‑UI with custom UI, you can dispatch compatible events so that DH‑UI’s trackers stay in sync:</p><div class="language-js vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> event</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> new</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> CustomEvent</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;dh:kv:changed&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  detail: {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    key: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;tracker:din_custom_resource::Character/Marlowe&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    val: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">3</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  },</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">});</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">window.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">dispatchEvent</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(event);</span></span></code></pre></div><p>Use unique, stable keys (see <a href="/Daggerheart-UI/concepts/state-storage.html">State Storage</a>) so your custom events play nicely with the built‑in state store.</p><hr><h2 id="when-to-use-this-page" tabindex="-1">When to use this page <a class="header-anchor" href="#when-to-use-this-page" aria-label="Permalink to &quot;When to use this page&quot;">​</a></h2><ul><li>Use <strong><a href="/Daggerheart-UI/concepts/dynamic-content.html">Dynamic Content</a></strong> to learn how to write templates inside YAML.</li><li>Use <strong><a href="/Daggerheart-UI/concepts/events.html">Events</a></strong> to understand how rest, damage, and trackers interact at a rules level.</li><li>Use <strong>this page</strong> only when you need to write custom JS that listens to or emits DH‑UI’s DOM events.</li></ul>`,42)])])}const g=s(n,[["render",l]]);export{k as __pageData,g as default};
