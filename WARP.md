# WARP.md

This file provides guidance to WARP (warp.dev) when working with code in this repository.

Project overview
- Obsidian plugin providing Daggerheart UI: registers multiple Markdown code block processors and a React-based view for abilities/traits. Output artifacts are `main.js` and `styles.css` per `manifest.json`.

Commands
- Install deps: `npm i`
- Develop (watch JS+CSS): `npm run dev` (runs `dev:css` + `dev:js` via concurrently). Reload Obsidian to pick up changes.
- Build once: `npm run build`
- CSS only (watch): `npm run dev:css`
- JS only (watch): `npm run dev:js`
- Lint: No project lint script/config is present. README suggests optional ESLint, e.g. `eslint ./src/` (requires a global install: `npm i -g eslint`).
- Tests: No test setup or scripts are defined in `package.json`.

Key files
- `manifest.json`: Obsidian plugin manifest (id `daggerheart-tooltips`, main `main.js`).
- `src/main.ts`: Plugin entry; bundles to `main.js` via esbuild.
- `styles.css`: Generated by a CSS build script (`scripts/build-css.mjs`) referenced by npm scripts.
- `tsconfig.json`: TS config (ES2020 target, JSX via React automatic runtime).
- `README.md`: Upstream Obsidian sample plugin instructions; includes dev/release guidance and optional ESLint notes.

Big-picture architecture
- Entry point: `src/main.ts` exports `DaggerheartPlugin extends Plugin` with standard Obsidian lifecycle (`onload`, `onunload`).
  - Settings: Loads `DEFAULT_SETTINGS`/`DaggerheartSettings` from `src/settings` and exposes a settings tab via `DaggerheartSettingTab`.
  - CSS theming: `applyGlobalArtCssVars()` writes CSS variables on `:root` (e.g. `--dh-art-w`, `--dh-art-maxh`, `--dh-art-fit`, `--dh-art-radius`, `--dh-art-align`) based on user settings.
  - Markdown processors:
    - React-rendered: registers code blocks `ability` and `traits`, rendered by `AbilityScoreView` (React) created with the current `App`.
    - Domain blocks: registers additional processors via helpers from `src/lib/domains/*` (e.g., badges, consumables, trackers, short/long rest, unified rest, damage, dashboard, vitals). Each registration is wrapped in `try/catch` with console errors on failure.
- State and persistence: A lightweight key-value store is initialized via `initializeStateStore(this, path)` where `path` comes from settings.
  - Implementation (visible in the bundled `main.js`):
    - `JsonDataStore` uses Obsidianâ€™s `vault.adapter` to read/write a JSON file at the configured path.
    - `KeyValueStore` provides async `get/set/has/delete/clear/keys/values/entries`, caching in-memory and persisting on writes.
  - `initializeStateStore` ensures a single store instance per file path and logs the active state file.
- Rendering stack: Uses React 18 (`react`, `react-dom`) with `@types` and JSX set to automatic runtime; Obsidian API types available via `types` in `tsconfig.json`.
- Build system: esbuild bundles `src/main.ts` to CommonJS `main.js`, targeting Node and marking `obsidian` as external. JSX is compiled with `--jsx=automatic`. CSS is produced by `scripts/build-css.mjs` into `styles.css`.

Operational notes (from README)
- For live development inside a vault: place this folder under `your-vault/.obsidian/plugins/`, run `npm run dev`, then reload Obsidian and enable the plugin in settings.
- Manual install/update: copy `manifest.json`, `main.js`, `styles.css` into `your-vault/.obsidian/plugins/daggerheart-tooltips/`.
